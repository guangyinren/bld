<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"/>
    <link rel="stylesheet" href=""/>
    <title>联系人</title>
    <link rel="stylesheet" href="../css/base.css"/>
    <link rel="stylesheet" href="../css/topic.css"/>
    <link rel="stylesheet" href="../css/Dynamic-hot.css"/>
    <link rel="stylesheet" href="../css/notic.css"/>
    <link rel="stylesheet" href="../css/mui.min.css"/>
    <link rel="stylesheet" href="../css/connect.css"/>
    <style>
        .Dynamic ul li:first-of-type{
            left: 45%;
        }
        .mui-collapse-content ul li{

            line-height:0.5rem;
          /*  padding-left: 1em;*/
            padding:0.1rem 0.3rem;
            position: relative;
        }
        .mui-collapse-content ul li:hover{
            background-color: #eee;
        }
        .mui-collapse-content ul li img{
            width: 1rem;
        border-radius: 50%;
            vertical-align: middle;
        }
        .mui-collapse-content ul li a{
            color:#333;
            width: 100%;
            display: block;
        }
        .mui-collapse-content ul li span{
            position: absolute;
            left: 14%;
            top: 15%;
            padding: 0;
            margin: 0;
        }
        .friends ul li span,.attention ul li span,.student ul li span{
            margin-left: 0.3rem;
        }

       .addFriends li{
            width: 100%;
            height: 2.3rem;

        }
     .addFriends li:hover{
            background-color: rgba(0, 0, 0, 0);
        }
       .addFriends li img{
            width: 1.2rem;
            float: left;
            border-radius: 50%;
            vertical-align: middle;
            margin-right: 0.3rem;
            margin-top: 0.25rem;
        }
       .addFriends li .top{
            margin-top: 0.5rem;
        }
     .addFriends li .top i{
            margin-right: 0.2rem;
            display: inline-block;
            font-size: 0.4rem;
            color:#666;
        }
       .addFriends li .top em{
            margin-right: 0.2rem;
            color:#666;
        }
         .addFriends li .add{
            display: inline-block;
            padding:0.1rem 0.4rem;
            border-radius: 5px;
            font-size: 0.3rem;
            margin-top: 0.2rem;
            background-color: #f093a1;
            color:#fff;
        }
        .mui-table-view-cell.mui-active{
            background-color:#f9acb8;
            color:#fff;
        }
        .Dynamic .transmit{
            background-image: url("../img/add.png");
        }
        .mui-collapse-content ul .no_commend,.mui-collapse-content ul .no_friends,.mui-collapse-content ul .no_classmate{
            color:#999;
            line-height: 1.5rem;
            text-indent: 2em;
            font-size: 0.3rem;
        }
        .reject{
            display: inline-block;
            padding: 0.11rem 0.41rem;
            border-radius: 5px;
            font-size: 0.3rem;
            margin-top: 0.2rem;
            margin-left: 0.6rem;
        }
        .mui-table-view-cell.mui-collapse .mui-collapse-content{
            padding: 0;
        }
        #loading{
            top: 38%;
        }
        .mui-collapse-content ul li .img_box{
            width: 1rem;
        }
        .mui-collapse-content ul li img{
            min-height: 0.8rem;
            max-height: 1rem;
        }
    </style>
</head>
<body>
<div id="loading">
    <img src="../img/login.gif" alt=""/>
</div>
<div class="layer">
    <!--头部关注-->
    <header class= "Dynamic connect_Header">
        <ul class="clearfix">
            <li class="connect"><a href="javascript:;">联系人</a> </li>
        </ul>
        <span class="transmit" onclick="window.location.href='add_friends.html'"></span>
    </header>
    <!--中间内容-->
    <div class="content">
      <div class="search">
          <input type="text" placeholder="搜索"/> <del></del>
      </div>
        <div class="list">
            <ul class="mui-table-view">
                <li class="mui-table-view-cell mui-collapse link_classmate">
                    <a class="" href="javascript:;"><i class="left"></i><span>好友申请</span></a>
                    <div class="mui-collapse-content addFriends">
                            <!--好友申请-->
                    </div>
                </li>
                <li class="mui-table-view-cell mui-collapse link_classmate">
                    <a class="" href="javascript:;"><i class="left"></i><span>同学</span></a>
                    <div class="mui-collapse-content student">

                    </div>
                </li>
                <li class="mui-table-view-cell mui-collapse link_classmate">
                    <a class="" href="javascript:;"><i class="left"></i><span>好友</span></a>
                    <div class="mui-collapse-content friends">

                    </div>
                </li>
                <li class="mui-table-view-cell mui-collapse link_classmate">
                    <a class="" href="javascript:;"><i class="left"></i><span>关注</span></a>
                    <div class="mui-collapse-content attention">

                    </div>
                </li>

            </ul>

        </div>
    </div>
    <!--页脚-->
    <footer class="Focus_footer">
        <ul class="clearfix">
            <li >
                <a href="focus.html">
                    <i></i>
                    <span>动态</span>
                </a>
            </li>
            <li>
                <a href="connect.html">
                    <i></i>
                    <span>联系人</span>
                </a>
            </li>
            <li>
                <a href="mine.html">
                    <i></i>
                    <span>个人中心</span>
                </a>
            </li>
        </ul>
    </footer>

</div>
</body>
<script src="../js/x_rem.js"></script>
<script src="../js/mui.min.js"></script>
<script src="../js/template-web.js"></script>
<script src="../js/jquery.js"></script>
<!--好友申请-->
<script id="auditList" type="text/html">
    <ul>
        {{if list.length==0}}
   <li class="no_commend">暂时没有好友申请</li>
   {{else if list.length!==0}}
   {{each list value i}}
        <li class="clearfix">
            {{if value.headPic=="" ||!value.headPic}}
            <img src="../img/beyond.png" alt=""/>
            {{else}}
            <div class="img_box"><img src="{{value.headPic}}" alt=""/></div>
            {{/if}}

            <div class="friend_left f_left">
                <div class="top">
                    <i>{{value.name?value.name:value.id}}</i>

                </div>
                <div class="button">
                    <button class="add" onclick="addNewFriends('{{value.relationId}}',1)">添加</button>
                    <button class="reject" onclick="addNewFriends('{{value.relationId}}',0)">拒绝</button>
                </div>
            </div>
        </li>
      {{/each}}
     {{/if}}
    </ul>
</script>
<!--关注列表-->
<script id="queryMyAttention" type="text/html">
    <ul>
        {{if list.length==0}}
        <li class="no_commend"> 您还没有关注任何人，赶紧去关注吧 ！</li>
        {{else}}
        {{each list as value i }}
        <li>
            <a href="Friends%20introduce_attention.html?user_id={{value.user_id}}">
                <div class="img_box"><img src="{{value.headpic_path}}" alt=""/></div>
                <span>{{value.nickname?value.nickname:value.username}}</span>
            </a>
        </li>
        {{/each}}
    {{/if}}
    </ul>
</script>
<!--同学 列表-->
<script id="student" type="text/html">
    <ul>
        {{if schoolmate.length==0}}
        <li class="no_classmate">您还没有任何同学好友，赶紧去添加吧 ！</li>
        {{else}}
        {{each schoolmate as value i}}
        <li>
            <a href="Friends%20introduce.html">
               <div class="img_box"><img src="{{value.headpic_path}}" alt=""/></div>
                <span>{{value.nickname?value.nickname:value.username}}</span>
            </a>
        </li>
        {{/each}}
        {{/if}}

    </ul>
</script>
<!--好友列表-->
<script id="friends" type="text/html">
    <ul >
    {{if relationuser.length ==0}}
    <li class="no_friends"> 您还没有任何好友，赶紧去添加吧 ！</li>
    {{else if relationuser.length !==0}}
        {{each relationuser as value i }}
        <li>
            <a href="Friends%20introduce.html?id={{value.id}}">
                {{if value.headPic=="" || !value.headPic}}
                <img src="../img/beyond.png" alt=""/>
                {{else}}
                <div class="img_box"> <img src="{{value.headPic}}" alt=""/></div>

                {{/if}}
                <span>{{value.remark?value.remark:value.name}}</span>
            </a>
        </li>
        {{/each}}
    {{/if}}
    </ul>
</script>
<script>
    (function($, doc) {
        $.init();
        $.plusReady(function() {
            var backButtonPress = 0;
            $.back = function(event) {
                backButtonPress++;
                if (backButtonPress > 1) {
                    plus.runtime.quit();
                } else {
                    plus.nativeUI.toast('再按一次退出应用');
                }
                setTimeout(function() {
                    backButtonPress = 0;
                }, 1000);
                return false;
            };
        });
    }(mui, document));

    $(document).ajaxStop(function(){
        $("#loading").hide();
    });

    //禁止 回退
    if (window.history && window.history.pushState) {
        $(window).on('popstate', function () {
            window.history.forward(1);
        });
    }
    //禁止 回退结束
    function addNewFriends(relationId,result){
        $.ajax({
            xhrFields: {
                withCredentials: true
            },
            type: "post",
            async: false,
            url: "http://39.104.127.252:8080/beyond/api/relationuser/audit",
            data:{
                relationId:relationId,
                result:result
            },
            dataType: 'json',
            success:function(data){
                console.log(data);
                if(data.code==0){
                    if(result==0){
                     alert("已拒绝");

                    }else{
                        alert("已添加");
                        auditList();
                        list();
                        queryMyAttention()
                    }
                }
            },
            error:function(data){
                console.log(data);
            }
        })
    }

        //当搜索框获取焦点的时候 跳转页面
        $(".search input").focus(function(){
           location.href='searchFriends.html' ;
        });
      if($(".mui-table-view>li").hasClass("mui-active"))  {
          mui('body').on('tap','a',function(){document.location.href=this.href;});
          alert(1);
        /*  $(".left").css(backgroundImage ,transform(rotate(90deg)));*/
      }
        //联系人
        var userId=localStorage.getItem('userId');
        if(userId){
            userId=userId.replace(/\"/g,"");
        }
        //console.log(userId);
        //最开始联系人列表请求
    function list(){
        $.ajax({
            xhrFields: {
                withCredentials: true
            },
            type: "post",
            async: false,
            url: "http://39.104.127.252:8080/beyond/api/relationuser/list",
            data:{
                userId:userId
            },
            dataType: 'json',
            success:function(data){
                console.log(data);
                if(data.code==0){
                    var friends=template("friends",data);
                    $(".friends").html(friends);
                    var student=template("student",data);
                    $(".student").html(student);
                }

            }
        })
    }
       list();

        //关注的联系人列表
        function queryMyAttention(){
            $.ajax({
                xhrFields: {
                    withCredentials: true
                },
                type: "post",
                async: false,
                url: "http://39.104.127.252:8080/beyond/api/attention/queryMyAttention",
                data:{
                    userId:userId,
                    type:0
                },
                dataType: 'json',
                success:function(data){
                    console.log(data);
                    if(data.code==0){
                        var queryMyAttention=template("queryMyAttention",data);
                         $(".attention").html(queryMyAttention);
                    }

                },
                error:function(data){
                    console.log(data);
                }
            })
        }
       queryMyAttention()
        //4.1.3联系人添加请求列表 (好友申请)
        function auditList(){
            $.ajax({
                xhrFields: {
                    withCredentials: true
                },
                type: "post",
                async: false,
                url: "http://39.104.127.252:8080/beyond/api/relationuser/auditList",
                data:{
                    userId:userId
                },
                dataType: 'json',
                success:function(data){
                    console.log(data);
                    if(data.code==0){
                        var html=template("auditList",data);
                         $(".addFriends").html(html);

                    }

                },
                error:function(data){
                    console.log(data);
                }
            })
        }
        auditList();
        //点击 审批联系人添加请求



</script>
</html>